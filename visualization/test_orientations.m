% -------------------------------------------------------------------------
% Author: ZAB
% DATE:   17 February 2020
% -------------------------------------------------------------------------
line='-------------------------------------------------------------------';

% location of the codes on LosertLab NAS
addpath(genpath('X:\MATLAB\ImageAnalysis'));
date                = '210409';
[saveDir,loadDir]   = getDirectories(date);
%%
radius  = 14;
n = 6417;

load(sprintf('%sIMS_filt_%04d.mat',saveDir,n),'IMS_filt');
getPositions(n,saveDir,loadDir,zmax,radius,12,4,IMS_filt);
% load(sprintf('%sIMS_filt_%04d.mat',saveDir,n),'IMS_filt');
load(sprintf('%sxyz_%04d.mat',saveDir,n),'xyzp');

% -------------------------------------------------------------------------
%%                      generate the rotating filter
% -------------------------------------------------------------------------
rcyl              = 4.5;                      % radius of hole in pixels
radius            = 13;
nAngles           = 8100;                     % angle resolution
A = rotatingLOGfilter(radius,rcyl,nAngles);
% -------------------------------------------------------------------------
%%                             Get Orientations
% -------------------------------------------------------------------------
ori = getOrientation(IMS_filt,A,xyzp,radius);
out = [xyzp,ori];
%%
[IMS_cyl,IMS_sph] = drawcyl(IMS_filt,xyzp,ori,radius-1,4,1);
%%
close all
green = zeros(size(IMS_filt,1),size(IMS_filt,2),3);
green(:,:,2) = 1;
figure(1);
movegui(gcf,[200,200]);
for i = 1:size(IMS_filt,3)
    imagesc(IMS_filt(:,:,i));
    colormap('gray');
    hold on
    
    iob_p = bwperim(IMS_sph(:,:,i));
    h = imshow(green);
    set(h,'AlphaData',iob_p);    
    
    iob_p = bwperim(IMS_cyl(:,:,i));
    h = imshow(green);
    set(h,'AlphaData',iob_p);
    
    hold off
    drawnow;

end
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------