% -------------------------------------------------------------------------
% Author: ZAB
% DATE:   17 February 2020
% -------------------------------------------------------------------------
line='-------------------------------------------------------------------';

% location of the codes on LosertLab NAS
if(ispc)
    addpath(genpath('Z:\Zack\lib\MATLAB\ImageAnalysis'));
%     addpath(genpath('Z:\Zack\lib\MATLAB\DataAnalysis'));
else
    addpath(genpath('/Volumes/GranularExperimentsData/Zack/lib/MATLAB/ImageAnalysis'));
end
date                = '210409';
[saveDir,loadDir]   = getDirectories(date);
radius    = 14;
zmax      = 270;
n         = 6417;
% n         = 21*16+2 + 50;
% xyzp = loadExtractions(n,0,saveDir,0,1);
% xyzp_bad = loadExtractions(n,0,saveDir,0,2);
%%
pre = 'start';
nCycles = 10;
n0 = n + 1 * 16;

load(sprintf('%stracks.ori.fixed.%s.%02d.mat',saveDir,pre,n0),'tracks');
xyzp = tracks(tracks(:,11) == 1,:);
load(sprintf('%sIMS_filt_%04d.mat',saveDir,n),'IMS_filt');
% -------------------------------------------------------------------------
%%
% -------------------------------------------------------------------------
[IMS_cyl,IMS_sph1] = drawcyl(IMS_filt,xyzp,radius-1,4);
% [~,IMS_sph2] = drawcyl(IMS_filt,xyzp_bad,radius-1);

% -------------------------------------------------------------------------
%%
% -------------------------------------------------------------------------
color = [3,155,229] / 255;
color = [0,176,255] / 255;
color = [0,0.7,1.0];
close all
figure(1);
movegui(gcf,[200,200]);

theta = linspace(0,2*pi,180);
for i = 150
%     xyzp_red = xyzp(abs(xyzp(:,3) - 150 ) < 12.5,:);
%     xyzp_bad_red = xyzp_bad(abs(xyzp_bad(:,3) - 150 ) < 12.5,:);
    
%     imagesc(IMS_filt(:,:,i));
%     
%     hold on
%     for ii = 1:size(xyzp_red(:,1))
%         rho = sqrt(12.5*12.5 - (i-xyzp_red(ii,3)).^2);
%         scatter(xyzp_red(ii,2) - rho*cos(theta),xyzp_red(ii,1) - rho*sin(theta),1,'r','filled');
%         drawnow;
%     end
%     
%     for ii = 1:size(xyzp_bad_red(:,1))
%         rho = sqrt(12.5*12.5 - (i-xyzp_bad_red(ii,3)).^2);
%         scatter(xyzp_bad_red(ii,2) - rho*cos(theta),xyzp_bad_red(ii,1) - rho*sin(theta),1,[0,0.7,1.0],'filled');
%         drawnow;
%     end
%     
    
        
    
    
    
%     viewOutline(IMS_filt,i,IMS_sph1,IMS_sph2,color)
    viewOutline(IMS_filt,i,IMS_sph1,IMS_cyl)
    colormap gray;
    axis off
    axis equal
end
print(gcf,'fig_outline.png');
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------
% -------------------------------------------------------------------------